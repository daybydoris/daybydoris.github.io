I"7<p><a href="https://cs50.harvard.edu/x/2020/notes/4/">CS50 2020 Lecture 4 Notes</a></p>

<h2 id="compare-비교">Compare 비교</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cs50.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Get two integers</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">(</span><span class="s">"i: "</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">(</span><span class="s">"j: "</span><span class="p">);</span>

    <span class="c1">// Compare integers</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Same</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Different</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위 코드는 integer <code class="language-plaintext highlighter-rouge">i</code>와 <code class="language-plaintext highlighter-rouge">j</code>를 입력받아 같으면 <code class="language-plaintext highlighter-rouge">Same</code>, 다르면 <code class="language-plaintext highlighter-rouge">Different</code>를 출력한다.<br /><br /></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cs50.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Get two strings</span>
    <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="s">"s: "</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">t</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="s">"t: "</span><span class="p">);</span>

    <span class="c1">// Compare strings' addresses</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Same</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Different</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위 코드를 보면 <code class="language-plaintext highlighter-rouge">i</code>와 <code class="language-plaintext highlighter-rouge">j</code>, 두 string을 입력받아 두 string이 같으면 <code class="language-plaintext highlighter-rouge">Same</code>, 다르면 <code class="language-plaintext highlighter-rouge">Different</code>를 출력할 것으로 기대된다.</p>

<p>하지만 같은 string을 입력해도 결과는 항상 <code class="language-plaintext highlighter-rouge">Different</code>가 나온다.<br /><br /></p>

<blockquote>
  <p>왜냐하면!<br /><br />string, 즉 포인터 변수인 <code class="language-plaintext highlighter-rouge">i</code>와 <code class="language-plaintext highlighter-rouge">j</code>는 각각 다른 메모리 주소를 가리키기 때문에 value가 같더라도 다르다고 판단하는 것이다.<br /><br /></p>
</blockquote>

<p><br /></p>

<h2 id="copy-복사">Copy 복사</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cs50.h&gt;
#include &lt;ctype.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="s">"s: "</span><span class="p">);</span>

    <span class="n">string</span> <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>

    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="c1">// Print string twice</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"s: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"t: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>string <code class="language-plaintext highlighter-rouge">s</code>를 입력받아 <code class="language-plaintext highlighter-rouge">t</code>에 복사하고, <code class="language-plaintext highlighter-rouge">t</code>의 첫번째 문자를 대문자로 만들어보려고 하는데 위의 코드를 실행해보면 둘다 대문자만 출력된다.</p>

<p><code class="language-plaintext highlighter-rouge">t</code>에 <code class="language-plaintext highlighter-rouge">s의 주소값</code>을 할당했기 때문에 둘은 같은 string을 바라보게 되고, <code class="language-plaintext highlighter-rouge">t</code>의 첫번째 문자를 대문자로 바꾸니까 똑같이 대문자가 출력되는 것이다!<br /><br /></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cs50.h&gt;
#include &lt;ctype.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="s">"s: "</span><span class="p">);</span>

    <span class="kt">char</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"s: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"t: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>따라서, <code class="language-plaintext highlighter-rouge">t</code>의 첫번째 문자만 대문자로 바꾸고 싶다면?!</p>

<p><strong>입력받은 <code class="language-plaintext highlighter-rouge">s</code>의 길이</strong> + <strong>NULL terminator</strong>만큼의 메모리를 <code class="language-plaintext highlighter-rouge">malloc</code>으로 할당해준 후, <code class="language-plaintext highlighter-rouge">s</code>의 문자들을 하나씩 복사해준 후 <code class="language-plaintext highlighter-rouge">t</code>의 첫번째 문자를 대문자로 바꿔야한다.</p>

<p><br /><br /></p>

<h2 id="메모리-누수--buffer-overflow">메모리 누수 &amp; Buffer overflow</h2>

<h3 id="메모리-누수">메모리 누수</h3>

<p><code class="language-plaintext highlighter-rouge">s</code>를 <code class="language-plaintext highlighter-rouge">t</code>로 복사할 때, 우리는 <code class="language-plaintext highlighter-rouge">malloc</code>으로 메모리를 할당했다.</p>

<p><code class="language-plaintext highlighter-rouge">malloc</code>으로 메모리를 할당한 뒤, <code class="language-plaintext highlighter-rouge">free</code>로 해제해줘야 메모리를 재사용할 수 있다.</p>

<p>해제를 하지 않으면 어플리케이션이 종료되기 전까지 해당 메모리가 계속 할당되어 메모리가 낭비되거나, 메모리가 부족한 현상이 발생할 수 있으므로 <code class="language-plaintext highlighter-rouge">free</code>로 해제해줘야한다.<br /></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">f</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="buffer-overflow">Buffer overflow</h3>

<p>위 함수 <code class="language-plaintext highlighter-rouge">f</code>에서 <code class="language-plaintext highlighter-rouge">int</code> 10개가 들어갈 수 있는 메모리를 할당했다.</p>

<p>그러나 다음 줄 <code class="language-plaintext highlighter-rouge">x[10]</code>은 10번째가 아니라 11번째로, 할당된 메모리 범위를 벗어난다.</p>

<p>이것을 <strong>buffer overflow</strong>라고 한다. <br /><br /></p>

<blockquote>
  <p>버퍼 오버플로는 보통 데이터를 저장하는 과정에서 그 데이터를 저장할 메모리 위치가 유효한지를 검사하지 않아 발생한다. 이러한 경우 데이터가 담긴 위치 근처에 있는 값이 손상되고 그 손상이 프로그램 실행에 영향을 미칠 수도 있다. 특히, 악의적인 공격으로 인해 프로그램에 취약점이 발생할 수도 있다. -위키백과</p>
</blockquote>

<p><br /><br /></p>

<h2 id="메모리-레이아웃">메모리 레이아웃</h2>

<p><img src="https://cs50.harvard.edu/x/2020/notes/4/memory_layout.png" alt="Grid with sections, from top to bottom: machine code, globals, heap (with arrow pointing downward), stack (with arrow pointing upward)" /><br /><br /></p>

<ul>
  <li>
    <p>컴퓨터 메모리는 데이터를 타입에 따라 다른 섹션에 저장한다.</p>

    <ol>
      <li>
        <p>기계코드</p>
      </li>
      <li>
        <p>전역변수</p>
      </li>
      <li>
        <p>heap 영역: <code class="language-plaintext highlighter-rouge">malloc</code>을 통해 동적 할당된 변수들</p>
      </li>
      <li>
        <p>stack 영역: 함수 내에서 선언되는 지역변수들(정적 할당)</p>
      </li>
    </ol>
  </li>
  <li>
    <p>heap 영역과 stack 영역은 서로 반대로 적치된다.</p>

    <p>=&gt; 동적 바인딩과 정적 바인딩을 구별하기 위해서이다!</p>
  </li>
</ul>

<h3 id="heap-overflow--stack-overflow">Heap overflow &amp; stack overflow</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">malloc</code>을 너무 많이 호출 =&gt; <strong>heap overflow</strong> 발생!</li>
  <li>호출되는 함수가 너무 많음 =&gt; <strong>stack overflow</strong> 발생!</li>
</ul>

<p><br /><br /></p>
:ET